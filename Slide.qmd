---
title: "Syntetic Contrlos"
subtitle: ""
author: "++++++++"
Email: ""
institute: "Instituto de Matemática, Estatística e Computação Científica (IMECC), </br> Universidade Estadual de Campinas (UNICAMP)."
toc: true
toc-depth: 1
toc-title: "Conteúdo"
knitr:
    opts_chunk: 
      fig.align: 'center'
execute:
    message: false
    warning: false
format:
    revealjs:
        slide-number: true
        show-slide-number: print
        self-contained: false
        chalkboard: true
        width: 1600
        height: 900
        theme: [default, styles.scss]
        incremental: true
        code-fold: true
        logo: "imagens/imecc.png"
        footer: "  |  ME920/MI628 - Inferência Causal |"
        highlight-style: "a11y"
        title-slide-attributes:
            data-background-image: "imagens/unicamp.png"
            data-background-size: 20%
            data-background-position: 99% 5%
            data-background-opacity: "1"
---

# Controle Sintético: introdução
## Introdução

- 

# Controle Sintético: Modelo

## Modelo


- Conta-se $J+1$ Unidades observadas em $T$ periodos.
   - A primeira unidade sofre intervenção
   - **Donor pool**, potenciais  controles, é o conjunto das unidades 2 a $J+1$
- A intervenção ocorre a partir de $T_0$ tal que $1 \leq T_0\leq T$ e seus efeitos podem se propagar de $T_0+1$ a $T$.

- $Y_{it}^N:$ Resultados potenciais de unidade $i$ no período $t$ (*sem intervenção*)

- $Y_{it}^{I}:$ Resultados potenciais de unidade $i$ nos períodos $t$ posteriores à exposição de $i$ à intervenção.

- A intervenção não afeta $Y$ antes da implementação e os $Y$ não-tratadas não são impactados pela intervenção.

## Modelo


- Sejam:
  - $\alpha_{it}=Y_{it}^I-Y_{it}^{N}$ o efeito da intervenção na unidade $i$ em $t$
    - $D_{it}=1$ se $i=1$ e $t>T_0$ e $D_{it}=0$ caso contrário
- os resultados são

$$Y_{it}=Y_{it}^N + \alpha_{it}D_{it}$$

- e queremos estimar $\alpha_{1t}=Y_{1t}^I-Y_{1t}^N$
- $Y_{1t}^N$ é missing após  a intervenção.

- Suponga que a equação de $Y_{it}^N$ seja dada pelo modelo de fatores 



$$Y_{it}^N=\delta_t+\theta_t Z_i + \lambda_t \mu_i + \varepsilon_{it}$$

## Modelo

  - $\delta_t$: é um fator comum no tempo não observado (comum entre as unidades )
  - $Z_i$: é o vetor de  covariadas observadas (não-afeladas pelo tratamento)  
  - $\lambda_t$: é um vetor de fatores comuns não-observados
  - $\mu_i$: é um vetor de fatores específicos 
  - $\varepsilon_{it}$:  reprecenta choques transitórios.
- $\lambda_t \mu_i$ permite que efeitos fixos variem no tempo ( mudanças temporárias), permite respostas heterôgeneas para fatores não-observados multiplos.


-  Cosidere um vetor de pesos $W=(W_1,W_2,...,W_{J+1})$ em que $W_j\geq 0$, $\forall j$ e que $\sum_{j=2}^{J+1}W_j=1$. cada $W$ representa um controle sintético (media ponderada das regiões) e o resultado potencial de cada controle sintético é:
$$\sum_{j=2}^{J+1} W_jY_{jt}^N=\delta_t+\theta_t\sum_{j=2}^{J+1} W_jZ_j + \lambda_t\sum_{j=2}^{J+1} W_j\mu_j+ \sum_{j=2}^{J+1} W_j\varepsilon_{jt}$$

## Modelo 

- Assim, tem-se que, subtraindo as equações (para $i=1$),
$$Y_{1t}^N-\sum_{j=2}^{J+1} W_jY_{jt}^N=\theta_t \left [ Z_1-\sum_{j=2}^{J+1} W_jZ_j \right ]+ \lambda_t \left[ \mu_1-\sum_{j=2}^{J+1} W_j\mu_j \right ]+ \sum_{j=2}^{J+1} W_j\left(\varepsilon_{1t}-\varepsilon_{jt} \right )$$



- Assuma que $\varepsilon_{it}$ sejam independentes entre $i$ e $t$.
- Mesmo assim, fatores não-observados $U_{it}=\lambda_{t}\mu_i+\varepsilon_{it}$ podem ser correlacionados entre $i$ e $t$ por conta de $\lambda_t\mu_i$.

- Por conta disso, não se pode estimar por MQO e é preciso eliminar o problema  dos fatores não-observados.
- Desta forma, é preciso supor que $\varepsilon_{it}$ sejam independentes de $\{ Z_i, U_i\}_{i=1}^{J+1}$.


## Modelo 

- denotemos por $P$ os siguintes vetores pré-tratamento: 
  - $Y_i^P:$ vetor $T_0 \times 1$ com o -t-ésimo elemento de $Y_{it}$
  - $\varepsilon^P:$ vetor $T_0 \times 1$ com o -t-ésimo elemento de $\varepsilon_{it}$
  - $\theta^P:$ vetor $T_0 \times r$ com o -t-ésima linha $\theta_t$ 
  - $\lambda^P:$ vetor $T_0 \times f$ com o -t-ésima linha $\lambda_t$
  

- Obtenemos da equação aplicada ao período pre-tratamento

$$Y_{1}^P-\sum_{j=2}^{J+1} W_jY_{j}^P=\theta^P \left [ Z_1-\sum_{j=2}^{J+1} W_jZ_j \right ]+ \lambda^P \left[ \mu_1-\sum_{j=2}^{J+1} W_j\mu_j \right ]+ \left(\varepsilon_1^{P}- \sum_{j=2}^{J+1} W_j \varepsilon_{j}^P\right )$$

- Assuma que $\lambda^{{P}^T} \lambda^P$ seja não-singular
- Subtraindo a equação multiplicada por $\lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T}$


## Modelo 


$$\left(  Y_{1t}^N - \sum_{j=2}^{J+1} W_jY_{jt}^N \right)-\lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T} \left ( Y_{1}^P\sum_{j=2}^{J+1} W_jY_{j}^P \right)$$

$$= \left( \theta_t-\lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T}\theta^P \right) \left [ Z_1-\sum_{j=2}^{J+1} W_jZ_j \right ]$$

$$+\left( \lambda_t- \lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T}  \lambda^P \right) \left[ \mu_1-\sum_{j=2}^{J+1} W_j\mu_j \right ]$$

$$+ \sum_{j=2}^{J+1} W_j\left(\varepsilon_{1t}-\varepsilon_{jt} \right )-  \lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T} \left(\varepsilon_1^{P}- \sum_{j=2}^{J+1} W_j \varepsilon_{j}^P\right )$$





## Modelo 

$$\left(  Y_{1t}^N - \sum_{j=2}^{J+1} W_jY_{jt}^N \right) = \lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T} \left ( Y_{1}^P\sum_{j=2}^{J+1} W_jY_{j}^P \right)$$

$$+ \left( \theta_t-\lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T}\theta^P \right) \left [ Z_1-\sum_{j=2}^{J+1} W_jZ_j \right ]$$

$$+ \sum_{j=2}^{J+1} W_j\left(\varepsilon_{1t}-\varepsilon_{jt} \right )-  \lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T} \left ( \sum_{j=2}^{J+1} W_j\left(\varepsilon_{1}^P-\varepsilon_{j}^P \right )  \right)$$



- Suponha agora que exista $W^*=(W_1^*,W_2^*,...,W_{J+1}^*)$ tal que 
$$\sum_{j=2}^{J+1}W_j^* Y_{j1}=Y_{11},\sum_{j=2}^{J+1}W_j^* Y_{j2}=Y_{12},...,\sum_{j=2}^{J+1}W_j^* Y_{jT_0}=Y_{1T_0}, \sum_{j=2}^{J+1}W_j^* Z_{j}=Z_{1} $$



## Modelo


- Assim, o ajuste do contrafactual pode ser reduzido a 

$$Y_{1j}^N-\sum W_j^* Y_{jt}^N=R_{1t}+R_{2t}+R_{3t}$$
- Onde 

$$R_{1t}= \lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T} \sum W_j^* \varepsilon_j^P,$$

$$R_{2t}= -\lambda_t \left(\lambda^{{P}^T} \lambda^P \right)^{-1} \lambda^{{P}^T}  \varepsilon_1^P,$$
$$R_{1t}= \left( \varepsilon_1^P-\sum_{j=2}^{J+2} W_j \varepsilon_j^P \right)$$


## Modelo

- Considere que $E(R_{2t})=E(R_{3t})=0, \forall t > T_0$
- E para $R_{1t}$ mostra-se que:
$$E|R_{1t}| \leq C(p)^{\frac{1}{p}}\left( \frac{\bar{\lambda}^2F}{\xi}\right)J^{\frac{1}{p}}max \left\{ \frac{(\bar{m}_p)^{\frac{1}{p}}}{T_0^{1-\frac{1}{p}}},\frac{\bar{\sigma}}{\sqrt{T_0}}  \right\}$$





- em que 
  - $C(p)$ é o p-ésimo momento central (menos 1) de uma variável aleatória  Poisson com $\lambda=1$
  - $\left( \frac{\bar{\lambda}^2F}{\xi}\right)$ é o limite inferior dos autovalores de $\frac{1}{M}\sum \lambda_t^T \lambda_t$
  - $\bar{m}_p$ é a média do p-ésimo momento de $\varepsilon_{jt}$
  - $\bar{\sigma}$ é o $max(\sigma_j^2$, em que $\sigma_j^2=E(\varepsilon_{jt}^2)$. 


## Modelo 


- A última equação implica que o viés do estimador ($E(R_{1t})$) pode ser limitado por uma função que vai para zero à medida que o número de períodos ($T_0$) de pré-tratamento aumenta.

- conforme $T_0$ cresce, o matching nos resultados pré-intervenção  ajuda a controlar fatores não-observados   e heterogeneidade dos efeitos observados sobre $Y$.


- As unidades parecidas nos determinantes observados e não observados de $Y$ deben producir trajetórias  similares ás de $Y$  em instantes posteriores a $T_0$. A diferença entre as trajectórias em $t> T_0$ é o efeito da intervenção

$$\hat{\alpha_{1t}}=Y_{1t}-\sum_{j+2}^{J+1}W_j^* Y_{jt} ~ t \in \{ T_0+1, T_0+2,...,T\}$$

## Modelo

- As condições para $W*$ esablecidas valem na igualdade se $(Y_{11}, Y_{12},...,Y_{1T_0}, Z_1^T)$ 

  pertence ao cone convexo gerado por 
  ${(Y_{21}, Y_{22},...,Y_{2T_0}, Z_2^T),..., (Y_{(J+1)1},(Y_{(J+1)2},...,Y_{(J+1)T_0}, Z_{(J+1)}^T)}$
- O soporte debe ser parecido
- $W^*$ satisfaz as condições aproximadamente
- viés de interpolação entre regiões com características diferentes




# Controle Sintético: Implementação
---
# Controle Sintético: Aplicação










